!function(){function t(t,n){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return c=t.done,t},e:function(t){s=!0,o=t},f:function(){try{c||null==i.return||i.return()}finally{if(s)throw o}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{hpy2:function(e,i,a){"use strict";a.r(i),a.d(i,"AddProductPageModule",(function(){return J}));var o,c=a("ofXK"),s=a("3Pt+"),u=a("TEn/"),p=a("tyNb"),b=a("mrSG"),f=a("fXoL"),d=a("p6Hd"),g=a("gcOT").a.CameraPreview,l={position:"rear",className:"fullscreen-video",toBack:!0,parent:"preview"},m=((o=function(){function t(){n(this,t),this._cameraState="off",this.captured=new f.n,this.format="image/jpeg"}return r(t,[{key:"capture",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.capture({});case 2:return e=t.sent,t.next=5,function(t,e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.height=i.naturalHeight,t.width=i.naturalWidth,r.drawImage(i,0,0);var a=t.toDataURL(e);n(a.replace(/data:image\/[^;]+;base64,/,""))},i.src="data:image/xxx;base64,"+t})));case 1:case"end":return n.stop()}}),n)})))}(e.value,this.format);case 5:n=t.sent,this.captured.emit(n);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"ionViewWillEnter",value:function(){this.start()}},{key:"ionViewDidLeave",value:function(){this.stop()}},{key:"ionViewWillLeave",value:function(){this.stop()}},{key:"ngAfterViewInit",value:function(){this.start()}},{key:"ngOnInit",value:function(){this.start()}},{key:"ngOnDestroy",value:function(){this.stop()}},{key:"start",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("off"!=this.cameraState){t.next=11;break}return t.prev=1,this._cameraState="starting",t.next=5,g.start(l);case 5:this._cameraState="on",t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this._cameraState="off";case 11:case"end":return t.stop()}}),t,this,[[1,8]])})))}},{key:"stop",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._cameraState="stopping",t.next=4,g.stop();case 4:return t.prev=4,this._cameraState="off",t.finish(4);case 7:case"end":return t.stop()}}),t,this,[[0,,4,7]])})))}},{key:"cameraState",get:function(){return this._cameraState}}]),t}()).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=f.Bb({type:o,selectors:[["app-camera"]],inputs:{format:"format"},outputs:{captured:"captured"},decls:10,vars:2,consts:[["id","preview",1,"camera-preview"],[1,"starting-container"],[1,"starting-message"],[1,"starting-spinner"],["name","bubbles"],[1,"starting-text"],["slot","fixed","vertical","bottom","horizontal","center"],[3,"click"],["icon","camera-outline"]],template:function(t,e){1&t&&(f.Ib(0,"div",0),f.Mb(1,"div",1),f.Mb(2,"div",2),f.Mb(3,"div",3),f.Ib(4,"ion-spinner",4),f.Lb(),f.Mb(5,"div",5),f.nc(6,"Starting camera..."),f.Lb(),f.Lb(),f.Lb(),f.Mb(7,"ion-fab",6),f.Mb(8,"ion-fab-button",7),f.Ub("click",(function(){return e.capture()})),f.Ib(9,"ion-icon",8),f.Lb(),f.Lb()),2&t&&(f.xb(1),f.zb("starting","starting"==e.cameraState))},directives:[u.C,u.i,u.j,u.m],styles:[".camera-preview[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;position:absolute}.camera-preview[_ngcontent-%COMP%]   .preview-feed[_ngcontent-%COMP%]{-o-object-fit:cover;object-fit:cover;width:100%;height:auto}.starting-container[_ngcontent-%COMP%]{display:none;flex-direction:column;justify-content:center;min-height:84px;text-align:center}.starting-container.starting[_ngcontent-%COMP%]{display:flex}.starting-container[_ngcontent-%COMP%]   .starting-message[_ngcontent-%COMP%]{display:block;margin:0 0 32px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.starting-container[_ngcontent-%COMP%]   .starting-message[_ngcontent-%COMP%]   .starting-text[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset}"]}),o);function h(t,e){if(1&t){var n=f.Nb();f.Mb(0,"ion-fab-button",4),f.Ub("click",(function(){return f.hc(n),f.Wb().confirm()})),f.Ib(1,"ion-icon",5),f.Lb()}}function v(t,e){if(1&t){var n=f.Nb();f.Mb(0,"app-camera",6),f.Ub("captured",(function(t){return f.hc(n),f.Wb().capturedPicture=t})),f.Lb()}if(2&t){var i=f.Wb();f.bc("format",i.format)}}function x(t,e){if(1&t){var n=f.Nb();f.Mb(0,"div",7),f.Mb(1,"div",8),f.Ib(2,"img",9),f.Lb(),f.Mb(3,"div",10),f.Mb(4,"div",11),f.nc(5,"Accept this photo?"),f.Lb(),f.Mb(6,"div",12),f.Mb(7,"ion-button",13),f.Ub("click",(function(){return f.hc(n),f.Wb().retake()})),f.nc(8,"retake"),f.Lb(),f.Mb(9,"ion-button",13),f.Ub("click",(function(){return f.hc(n),f.Wb().confirm()})),f.nc(10,"ok!"),f.Lb(),f.Lb(),f.Lb(),f.Lb()}if(2&t){var i=f.Wb();f.xb(2),f.bc("src","data:image/jpeg;base64,"+i.capturedPicture,f.jc)}}var k,y=["*"],w=((k=function(){function t(){n(this,t),this.format="image/jpeg",this.allowSkip=!1,this.captured=new f.n}return r(t,[{key:"retake",value:function(){this.capturedPicture=void 0}},{key:"confirm",value:function(){this.captured.emit(this.capturedPicture),this.capturedPicture=void 0}}]),t}()).\u0275fac=function(t){return new(t||k)},k.\u0275cmp=f.Bb({type:k,selectors:[["app-camera-ui"]],inputs:{format:"format",allowSkip:"allowSkip"},outputs:{captured:"captured"},ngContentSelectors:y,decls:5,vars:3,consts:[[1,"camera-overlay"],["class","skip-button","color","light",3,"click",4,"ngIf"],[3,"format","captured",4,"ngIf"],["class","snap",4,"ngIf"],["color","light",1,"skip-button",3,"click"],["name","return-up-forward-outline"],[3,"format","captured"],[1,"snap"],[1,"snap-img"],[3,"src"],[1,"snap-question"],[1,"question"],[1,"buttons"],[3,"click"]],template:function(t,e){1&t&&(f.ac(),f.Mb(0,"div",0),f.Zb(1),f.lc(2,h,2,0,"ion-fab-button",1),f.Lb(),f.lc(3,v,1,1,"app-camera",2),f.lc(4,x,11,1,"div",3)),2&t&&(f.xb(2),f.bc("ngIf",!e.capturedPicture&&e.allowSkip),f.xb(1),f.bc("ngIf",!e.capturedPicture),f.xb(1),f.bc("ngIf",!!e.capturedPicture))},directives:[c.k,u.j,u.m,m,u.e],styles:[".camera-overlay[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;bottom:80px;left:20px;z-index:100;font-weight:700;font-size:1.5em;text-align:center}.camera-overlay[_ngcontent-%COMP%]   .skip-button[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;left:0;margin:auto}.snap[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh}.snap[_ngcontent-%COMP%]   .snap-img[_ngcontent-%COMP%]{flex-grow:1;display:flex}.snap[_ngcontent-%COMP%]   .snap-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{-webkit-animation:drop .2s ease-out;animation:drop .2s ease-out;transform:rotate(-1deg) scale(.95);max-width:100%;border:10px solid #fff;margin:auto}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:50px}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]   .question[_ngcontent-%COMP%]{font-weight:700;font-size:1.5em;text-align:center}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly}@-webkit-keyframes drop{0%{transform:rotate(3deg) scale(1.05);opacity:.5}to{transform:rotate(-1deg) scale(.95);opacity:1}}@keyframes drop{0%{transform:rotate(3deg) scale(1.05);opacity:.5}to{transform:rotate(-1deg) scale(.95);opacity:1}}"]}),k),M=function(){return["/"]};function P(t,e){if(1&t){var n=f.Nb();f.Kb(0),f.Mb(1,"app-camera-ui",2),f.Ub("captured",(function(t){return f.hc(n),f.Wb().doStep(t)})),f.Mb(2,"div",3),f.nc(3,"Take a photo of the front of the item."),f.Lb(),f.Lb(),f.Mb(4,"ion-fab",4),f.Mb(5,"ion-fab-button",5),f.Ib(6,"ion-icon",6),f.Lb(),f.Lb(),f.Jb()}2&t&&(f.xb(5),f.bc("routerLink",f.dc(1,M)))}function C(t,e){if(1&t){var n=f.Nb();f.Kb(0),f.Mb(1,"app-camera-ui",2),f.Ub("captured",(function(t){return f.hc(n),f.Wb().doStep(t)})),f.Mb(2,"div",3),f.nc(3,"Take a photo of the back of the item."),f.Lb(),f.Lb(),f.Mb(4,"ion-fab",4),f.Mb(5,"ion-fab-button",5),f.Ib(6,"ion-icon",6),f.Lb(),f.Lb(),f.Jb()}2&t&&(f.xb(5),f.bc("routerLink",f.dc(1,M)))}function O(t,e){if(1&t){var n=f.Nb();f.Kb(0),f.Mb(1,"app-camera-ui",2),f.Ub("captured",(function(t){return f.hc(n),f.Wb().doStep(t)})),f.Mb(2,"div",3),f.nc(3,"Take a photo of the ingredients of the item."),f.Lb(),f.Lb(),f.Mb(4,"ion-fab",4),f.Mb(5,"ion-fab-button",5),f.Ib(6,"ion-icon",6),f.Lb(),f.Lb(),f.Jb()}2&t&&(f.xb(5),f.bc("routerLink",f.dc(1,M)))}function L(t,e){if(1&t){var n=f.Nb();f.Kb(0),f.Mb(1,"app-camera-ui",7),f.Ub("captured",(function(t){return f.hc(n),f.Wb().doStep(t)})),f.Mb(2,"div",3),f.nc(3,"Take extra photos of the item, or press skip."),f.Lb(),f.Lb(),f.Mb(4,"ion-fab",4),f.Mb(5,"ion-fab-button",5),f.Ib(6,"ion-icon",6),f.Lb(),f.Lb(),f.Jb()}2&t&&(f.xb(5),f.bc("routerLink",f.dc(1,M)))}function _(t,e){if(1&t&&(f.Kb(0),f.Mb(1,"div",8),f.Mb(2,"div",9),f.Mb(3,"div",10),f.Ib(4,"ion-spinner",11),f.Lb(),f.Mb(5,"div",12),f.nc(6),f.Lb(),f.Lb(),f.Lb(),f.Jb()),2&t){var n=f.Wb();f.xb(6),f.pc("Uploading ",n.uploadingText,"...")}}var S,j,I,A=function(t){return t[t.front=0]="front",t[t.back=1]="back",t[t.ingredients=2]="ingredients",t[t.extra=3]="extra",t[t.save=4]="save",t}({}),T=[{path:":ean",component:(S=function(){function e(t,i,r){n(this,e),this.activatedRoute=t,this.productsApiService=i,this.router=r,this.step=A.front,this.steps=A,this.images={front:void 0,back:void 0,nutrients:void 0,ingredients:void 0,extra:[]}}return r(e,[{key:"doStep",value:function(t){switch(this.step){case A.front:this.images.front=t,this.step=A.back;break;case A.back:this.images.back=t,this.step=A.ingredients;break;case A.ingredients:this.images.ingredients=t,this.step=A.extra;break;case A.extra:t?this.images.extra.push(t):(this.step=A.save,this.save())}}},{key:"save",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,r,a,o,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.activatedRoute.snapshot.paramMap.get("ean"),i={ean:n,name:n,brand:null,origin:"App upload"},this.uploadingText="product info",e.next=4,this.productsApiService.productsAddProduct({body:i}).toPromise();case 4:if(r=e.sent,e.t0=this.images.front,!e.t0){e.next=10;break}return this.uploadingText="front",e.next=10,this.upload(r.id,"front",this.images.front);case 10:if(e.t1=this.images.back,!e.t1){e.next=15;break}return this.uploadingText="back",e.next=15,this.upload(r.id,"back",this.images.back);case 15:if(e.t2=this.images.ingredients,!e.t2){e.next=20;break}return this.uploadingText="ingredients",e.next=20,this.upload(r.id,"ingredients",this.images.ingredients);case 20:a=0,o=t(this.images.extra),e.prev=22,o.s();case 24:if((c=o.n()).done){e.next=31;break}return s=c.value,this.uploadingText="extra "+a++,e.next=29,this.upload(r.id,"extra",s);case 29:e.next=24;break;case 31:e.next=36;break;case 33:e.prev=33,e.t3=e.catch(22),o.e(e.t3);case 36:return e.prev=36,o.f(),e.finish(36);case 39:return this.uploadingText="done",e.next=42,this.router.navigate(["product",r.id],{replaceUrl:!0});case 42:case"end":return e.stop()}}),e,this,[[22,33,36,39]])})))}},{key:"upload",value:function(t,e,n){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.productsApiService.productsAddProductImage({productGuid:t,body:{mimeType:"image/jpeg",usage:e,data:n}}).toPromise();case 2:case"end":return i.stop()}}),i,this)})))}}]),e}(),S.\u0275fac=function(t){return new(t||S)(f.Hb(p.a),f.Hb(d.c),f.Hb(p.g))},S.\u0275cmp=f.Bb({type:S,selectors:[["app-add-product"]],decls:6,vars:6,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"captured"],[1,"usage"],["slot","fixed","vertical","top","horizontal","start"],["replaceUrl","",3,"routerLink"],["icon","arrow-back-outline"],["allowSkip","true",3,"captured"],[1,"uploading-container"],[1,"uploading-message"],[1,"uploading-spinner"],["name","bubbles"],[1,"uploading-text"]],template:function(t,e){1&t&&(f.Kb(0,0),f.lc(1,P,7,2,"ng-container",1),f.lc(2,C,7,2,"ng-container",1),f.lc(3,O,7,2,"ng-container",1),f.lc(4,L,7,2,"ng-container",1),f.lc(5,_,7,1,"ng-container",1),f.Jb()),2&t&&(f.bc("ngSwitch",e.step),f.xb(1),f.bc("ngSwitchCase",e.steps.front),f.xb(1),f.bc("ngSwitchCase",e.steps.back),f.xb(1),f.bc("ngSwitchCase",e.steps.ingredients),f.xb(1),f.bc("ngSwitchCase",e.steps.extra),f.xb(1),f.bc("ngSwitchCase",e.steps.save))},directives:[c.l,c.m,w,u.i,u.j,u.J,p.h,u.m,u.C],styles:[".uploading-container[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;min-height:84px;text-align:center}.uploading-container[_ngcontent-%COMP%]   .uploading-message[_ngcontent-%COMP%]{display:block;margin:0 0 32px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.uploading-container[_ngcontent-%COMP%]   .uploading-message[_ngcontent-%COMP%]   .uploading-text[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset}.usage[_ngcontent-%COMP%]{margin:50px}"]}),S)}],R=((j=function t(){n(this,t)}).\u0275mod=f.Fb({type:j}),j.\u0275inj=f.Eb({factory:function(t){return new(t||j)},imports:[[p.i.forChild(T)],p.i]}),j),U=a("sYmb"),W=a("j1ZV"),J=((I=function t(){n(this,t)}).\u0275mod=f.Fb({type:I}),I.\u0275inj=f.Eb({factory:function(t){return new(t||I)},imports:[[c.c,W.a,s.a,u.F,R,U.c]]}),I)}}])}();
//# sourceMappingURL=12-es5.502d3c7bde5e895d8882.js.map
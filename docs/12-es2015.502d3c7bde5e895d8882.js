(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{hpy2:function(t,n,e){"use strict";e.r(n),e.d(n,"AddProductPageModule",(function(){return S}));var i=e("ofXK"),a=e("3Pt+"),o=e("TEn/"),c=e("tyNb"),r=e("mrSG"),s=e("fXoL"),b=e("p6Hd");const p=e("gcOT").a.CameraPreview,u={position:"rear",className:"fullscreen-video",toBack:!0,parent:"preview"};let d=(()=>{class t{constructor(){this._cameraState="off",this.captured=new s.n,this.format="image/jpeg"}get cameraState(){return this._cameraState}capture(){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield p.capture({}),n=yield function(t,n){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(e=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=function(){const t=document.createElement("canvas"),a=t.getContext("2d");t.height=i.naturalHeight,t.width=i.naturalWidth,a.drawImage(i,0,0);const o=t.toDataURL(n);e(o.replace(/data:image\/[^;]+;base64,/,""))},i.src="data:image/xxx;base64,"+t})}))}(t.value,this.format);this.captured.emit(n)}))}ionViewWillEnter(){this.start()}ionViewDidLeave(){this.stop()}ionViewWillLeave(){this.stop()}ngAfterViewInit(){this.start()}ngOnInit(){this.start()}ngOnDestroy(){this.stop()}start(){return Object(r.a)(this,void 0,void 0,(function*(){if("off"==this.cameraState)try{this._cameraState="starting",yield p.start(u),this._cameraState="on"}catch(t){this._cameraState="off"}}))}stop(){return Object(r.a)(this,void 0,void 0,(function*(){try{this._cameraState="stopping",yield p.stop()}finally{this._cameraState="off"}}))}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=s.Bb({type:t,selectors:[["app-camera"]],inputs:{format:"format"},outputs:{captured:"captured"},decls:10,vars:2,consts:[["id","preview",1,"camera-preview"],[1,"starting-container"],[1,"starting-message"],[1,"starting-spinner"],["name","bubbles"],[1,"starting-text"],["slot","fixed","vertical","bottom","horizontal","center"],[3,"click"],["icon","camera-outline"]],template:function(t,n){1&t&&(s.Ib(0,"div",0),s.Mb(1,"div",1),s.Mb(2,"div",2),s.Mb(3,"div",3),s.Ib(4,"ion-spinner",4),s.Lb(),s.Mb(5,"div",5),s.nc(6,"Starting camera..."),s.Lb(),s.Lb(),s.Lb(),s.Mb(7,"ion-fab",6),s.Mb(8,"ion-fab-button",7),s.Ub("click",(function(){return n.capture()})),s.Ib(9,"ion-icon",8),s.Lb(),s.Lb()),2&t&&(s.xb(1),s.zb("starting","starting"==n.cameraState))},directives:[o.C,o.i,o.j,o.m],styles:[".camera-preview[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;position:absolute}.camera-preview[_ngcontent-%COMP%]   .preview-feed[_ngcontent-%COMP%]{-o-object-fit:cover;object-fit:cover;width:100%;height:auto}.starting-container[_ngcontent-%COMP%]{display:none;flex-direction:column;justify-content:center;min-height:84px;text-align:center}.starting-container.starting[_ngcontent-%COMP%]{display:flex}.starting-container[_ngcontent-%COMP%]   .starting-message[_ngcontent-%COMP%]{display:block;margin:0 0 32px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.starting-container[_ngcontent-%COMP%]   .starting-message[_ngcontent-%COMP%]   .starting-text[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset}"]}),t})();function g(t,n){if(1&t){const t=s.Nb();s.Mb(0,"ion-fab-button",4),s.Ub("click",(function(){return s.hc(t),s.Wb().confirm()})),s.Ib(1,"ion-icon",5),s.Lb()}}function l(t,n){if(1&t){const t=s.Nb();s.Mb(0,"app-camera",6),s.Ub("captured",(function(n){return s.hc(t),s.Wb().capturedPicture=n})),s.Lb()}if(2&t){const t=s.Wb();s.bc("format",t.format)}}function f(t,n){if(1&t){const t=s.Nb();s.Mb(0,"div",7),s.Mb(1,"div",8),s.Ib(2,"img",9),s.Lb(),s.Mb(3,"div",10),s.Mb(4,"div",11),s.nc(5,"Accept this photo?"),s.Lb(),s.Mb(6,"div",12),s.Mb(7,"ion-button",13),s.Ub("click",(function(){return s.hc(t),s.Wb().retake()})),s.nc(8,"retake"),s.Lb(),s.Mb(9,"ion-button",13),s.Ub("click",(function(){return s.hc(t),s.Wb().confirm()})),s.nc(10,"ok!"),s.Lb(),s.Lb(),s.Lb(),s.Lb()}if(2&t){const t=s.Wb();s.xb(2),s.bc("src","data:image/jpeg;base64,"+t.capturedPicture,s.jc)}}const m=["*"];let h=(()=>{class t{constructor(){this.format="image/jpeg",this.allowSkip=!1,this.captured=new s.n}retake(){this.capturedPicture=void 0}confirm(){this.captured.emit(this.capturedPicture),this.capturedPicture=void 0}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=s.Bb({type:t,selectors:[["app-camera-ui"]],inputs:{format:"format",allowSkip:"allowSkip"},outputs:{captured:"captured"},ngContentSelectors:m,decls:5,vars:3,consts:[[1,"camera-overlay"],["class","skip-button","color","light",3,"click",4,"ngIf"],[3,"format","captured",4,"ngIf"],["class","snap",4,"ngIf"],["color","light",1,"skip-button",3,"click"],["name","return-up-forward-outline"],[3,"format","captured"],[1,"snap"],[1,"snap-img"],[3,"src"],[1,"snap-question"],[1,"question"],[1,"buttons"],[3,"click"]],template:function(t,n){1&t&&(s.ac(),s.Mb(0,"div",0),s.Zb(1),s.lc(2,g,2,0,"ion-fab-button",1),s.Lb(),s.lc(3,l,1,1,"app-camera",2),s.lc(4,f,11,1,"div",3)),2&t&&(s.xb(2),s.bc("ngIf",!n.capturedPicture&&n.allowSkip),s.xb(1),s.bc("ngIf",!n.capturedPicture),s.xb(1),s.bc("ngIf",!!n.capturedPicture))},directives:[i.k,o.j,o.m,d,o.e],styles:[".camera-overlay[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;bottom:80px;left:20px;z-index:100;font-weight:700;font-size:1.5em;text-align:center}.camera-overlay[_ngcontent-%COMP%]   .skip-button[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;left:0;margin:auto}.snap[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh}.snap[_ngcontent-%COMP%]   .snap-img[_ngcontent-%COMP%]{flex-grow:1;display:flex}.snap[_ngcontent-%COMP%]   .snap-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{-webkit-animation:drop .2s ease-out;animation:drop .2s ease-out;transform:rotate(-1deg) scale(.95);max-width:100%;border:10px solid #fff;margin:auto}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:50px}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]   .question[_ngcontent-%COMP%]{font-weight:700;font-size:1.5em;text-align:center}.snap[_ngcontent-%COMP%]   .snap-question[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly}@-webkit-keyframes drop{0%{transform:rotate(3deg) scale(1.05);opacity:.5}to{transform:rotate(-1deg) scale(.95);opacity:1}}@keyframes drop{0%{transform:rotate(3deg) scale(1.05);opacity:.5}to{transform:rotate(-1deg) scale(.95);opacity:1}}"]}),t})();const v=function(){return["/"]};function x(t,n){if(1&t){const t=s.Nb();s.Kb(0),s.Mb(1,"app-camera-ui",2),s.Ub("captured",(function(n){return s.hc(t),s.Wb().doStep(n)})),s.Mb(2,"div",3),s.nc(3,"Take a photo of the front of the item."),s.Lb(),s.Lb(),s.Mb(4,"ion-fab",4),s.Mb(5,"ion-fab-button",5),s.Ib(6,"ion-icon",6),s.Lb(),s.Lb(),s.Jb()}2&t&&(s.xb(5),s.bc("routerLink",s.dc(1,v)))}function M(t,n){if(1&t){const t=s.Nb();s.Kb(0),s.Mb(1,"app-camera-ui",2),s.Ub("captured",(function(n){return s.hc(t),s.Wb().doStep(n)})),s.Mb(2,"div",3),s.nc(3,"Take a photo of the back of the item."),s.Lb(),s.Lb(),s.Mb(4,"ion-fab",4),s.Mb(5,"ion-fab-button",5),s.Ib(6,"ion-icon",6),s.Lb(),s.Lb(),s.Jb()}2&t&&(s.xb(5),s.bc("routerLink",s.dc(1,v)))}function k(t,n){if(1&t){const t=s.Nb();s.Kb(0),s.Mb(1,"app-camera-ui",2),s.Ub("captured",(function(n){return s.hc(t),s.Wb().doStep(n)})),s.Mb(2,"div",3),s.nc(3,"Take a photo of the ingredients of the item."),s.Lb(),s.Lb(),s.Mb(4,"ion-fab",4),s.Mb(5,"ion-fab-button",5),s.Ib(6,"ion-icon",6),s.Lb(),s.Lb(),s.Jb()}2&t&&(s.xb(5),s.bc("routerLink",s.dc(1,v)))}function w(t,n){if(1&t){const t=s.Nb();s.Kb(0),s.Mb(1,"app-camera-ui",7),s.Ub("captured",(function(n){return s.hc(t),s.Wb().doStep(n)})),s.Mb(2,"div",3),s.nc(3,"Take extra photos of the item, or press skip."),s.Lb(),s.Lb(),s.Mb(4,"ion-fab",4),s.Mb(5,"ion-fab-button",5),s.Ib(6,"ion-icon",6),s.Lb(),s.Lb(),s.Jb()}2&t&&(s.xb(5),s.bc("routerLink",s.dc(1,v)))}function y(t,n){if(1&t&&(s.Kb(0),s.Mb(1,"div",8),s.Mb(2,"div",9),s.Mb(3,"div",10),s.Ib(4,"ion-spinner",11),s.Lb(),s.Mb(5,"div",12),s.nc(6),s.Lb(),s.Lb(),s.Lb(),s.Jb()),2&t){const t=s.Wb();s.xb(6),s.pc("Uploading ",t.uploadingText,"...")}}var P=function(t){return t[t.front=0]="front",t[t.back=1]="back",t[t.ingredients=2]="ingredients",t[t.extra=3]="extra",t[t.save=4]="save",t}({});const C=[{path:":ean",component:(()=>{class t{constructor(t,n,e){this.activatedRoute=t,this.productsApiService=n,this.router=e,this.step=P.front,this.steps=P,this.images={front:void 0,back:void 0,nutrients:void 0,ingredients:void 0,extra:[]}}doStep(t){switch(this.step){case P.front:this.images.front=t,this.step=P.back;break;case P.back:this.images.back=t,this.step=P.ingredients;break;case P.ingredients:this.images.ingredients=t,this.step=P.extra;break;case P.extra:t?this.images.extra.push(t):(this.step=P.save,this.save())}}save(){return Object(r.a)(this,void 0,void 0,(function*(){const t=this.activatedRoute.snapshot.paramMap.get("ean"),n={ean:t,name:t,brand:null,origin:"App upload"};this.uploadingText="product info";const e=yield this.productsApiService.productsAddProduct({body:n}).toPromise();this.images.front&&(this.uploadingText="front",yield this.upload(e.id,"front",this.images.front)),this.images.back&&(this.uploadingText="back",yield this.upload(e.id,"back",this.images.back)),this.images.ingredients&&(this.uploadingText="ingredients",yield this.upload(e.id,"ingredients",this.images.ingredients));let i=0;for(const a of this.images.extra)this.uploadingText="extra "+i++,yield this.upload(e.id,"extra",a);this.uploadingText="done",yield this.router.navigate(["product",e.id],{replaceUrl:!0})}))}upload(t,n,e){return Object(r.a)(this,void 0,void 0,(function*(){yield this.productsApiService.productsAddProductImage({productGuid:t,body:{mimeType:"image/jpeg",usage:n,data:e}}).toPromise()}))}}return t.\u0275fac=function(n){return new(n||t)(s.Hb(c.a),s.Hb(b.c),s.Hb(c.g))},t.\u0275cmp=s.Bb({type:t,selectors:[["app-add-product"]],decls:6,vars:6,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"captured"],[1,"usage"],["slot","fixed","vertical","top","horizontal","start"],["replaceUrl","",3,"routerLink"],["icon","arrow-back-outline"],["allowSkip","true",3,"captured"],[1,"uploading-container"],[1,"uploading-message"],[1,"uploading-spinner"],["name","bubbles"],[1,"uploading-text"]],template:function(t,n){1&t&&(s.Kb(0,0),s.lc(1,x,7,2,"ng-container",1),s.lc(2,M,7,2,"ng-container",1),s.lc(3,k,7,2,"ng-container",1),s.lc(4,w,7,2,"ng-container",1),s.lc(5,y,7,1,"ng-container",1),s.Jb()),2&t&&(s.bc("ngSwitch",n.step),s.xb(1),s.bc("ngSwitchCase",n.steps.front),s.xb(1),s.bc("ngSwitchCase",n.steps.back),s.xb(1),s.bc("ngSwitchCase",n.steps.ingredients),s.xb(1),s.bc("ngSwitchCase",n.steps.extra),s.xb(1),s.bc("ngSwitchCase",n.steps.save))},directives:[i.l,i.m,h,o.i,o.j,o.J,c.h,o.m,o.C],styles:[".uploading-container[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;min-height:84px;text-align:center}.uploading-container[_ngcontent-%COMP%]   .uploading-message[_ngcontent-%COMP%]{display:block;margin:0 0 32px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.uploading-container[_ngcontent-%COMP%]   .uploading-message[_ngcontent-%COMP%]   .uploading-text[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset}.usage[_ngcontent-%COMP%]{margin:50px}"]}),t})()}];let L=(()=>{class t{}return t.\u0275mod=s.Fb({type:t}),t.\u0275inj=s.Eb({factory:function(n){return new(n||t)},imports:[[c.i.forChild(C)],c.i]}),t})();var O=e("sYmb"),_=e("j1ZV");let S=(()=>{class t{}return t.\u0275mod=s.Fb({type:t}),t.\u0275inj=s.Eb({factory:function(n){return new(n||t)},imports:[[i.c,_.a,a.a,o.F,L,O.c]]}),t})()}}]);
//# sourceMappingURL=12-es2015.502d3c7bde5e895d8882.js.map